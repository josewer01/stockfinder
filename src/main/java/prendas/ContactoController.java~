
package com.example.contactos;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import java.util.concurrent.atomic.AtomicLong;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class ContactoController {

    private Connection c = null; // Objeto de tipo coneccion donde se guardaran los datos de coneccion
	private Statement stmt = null; // Objeto de tipo sentencia SQL
	private ResultSet rs = null; // Objeto de tipo resultado Query SQL

    public ContactoController() throws SQLException {
		try {
			Class.forName("org.postgresql.Driver");
			c = DriverManager.getConnection("jdbc:postgresql://localhost:5432/contactos");
			c.setAutoCommit(true);
		} catch (Exception e) {
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
			c.close();
		}
	}

    
    @GetMapping("/contacto")
    public Contacto contacto(
    @RequestParam(value = "apellido", defaultValue = "Fernandez") String apellido) throws SQLException
    {
	if (c != null) {

		    String query = "SELECT * FROM contactos WHERE apellidos = ?";
			PreparedStatement s = c.prepareStatement(query);
     		s.setString(1, apellido);

   			 ResultSet rs = s.executeQuery();

			if (rs == null){
				cerrarDatabase();
				return null;
			}
			else {
				while (rs.next()){
				    objeto = new Contacto(rs.getLong("num"),rs.getString("nombre"),rs.getString("apellido"),rs.getString("email"),rs.getString("telefono"));
					}
					cerrarDatabase();

				return objeto;
			}
		} else

			return null;
	}
	

    }

							    
}
